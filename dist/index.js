function e(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=r(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var o=0,l=function(){};return{s:l,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,n=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return n=e.done,e},e:function(e){s=!0,i=e},f:function(){try{n||null==a.return||a.return()}finally{if(s)throw i}}}}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,o,l,i,n=[],s=!0,d=!1;try{if(l=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(a=l.call(r)).done)&&(n.push(a.value),n.length!==t);s=!0);}catch(e){d=!0,o=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw o}}return n}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */n=function(){return t};var e,t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},l="function"==typeof Symbol?Symbol:{},i=l.iterator||"@@iterator",s=l.asyncIterator||"@@asyncIterator",d=l.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function h(e,t,r,a){var l=t&&t.prototype instanceof g?t:g,i=Object.create(l.prototype),n=new k(a||[]);return o(i,"_invoke",{value:E(e,r,n)}),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",m="suspendedYield",v="executing",f="completed",b={};function g(){}function w(){}function y(){}var C={};c(C,i,(function(){return this}));var I=Object.getPrototypeOf,N=I&&I(I(B([])));N&&N!==r&&a.call(N,i)&&(C=N);var x=y.prototype=g.prototype=Object.create(C);function T(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function r(o,l,i,n){var s=u(e[o],e,l);if("throw"!==s.type){var d=s.arg,c=d.value;return c&&"object"==typeof c&&a.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,i,n)}),(function(e){r("throw",e,i,n)})):t.resolve(c).then((function(e){d.value=e,i(d)}),(function(e){return r("throw",e,i,n)}))}n(s.arg)}var l;o(this,"_invoke",{value:function(e,a){function o(){return new t((function(t,o){r(e,a,t,o)}))}return l=l?l.then(o,o):o()}})}function E(t,r,a){var o=p;return function(l,i){if(o===v)throw new Error("Generator is already running");if(o===f){if("throw"===l)throw i;return{value:e,done:!0}}for(a.method=l,a.arg=i;;){var n=a.delegate;if(n){var s=S(n,a);if(s){if(s===b)continue;return s}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(o===p)throw o=f,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o=v;var d=u(t,r,a);if("normal"===d.type){if(o=a.done?f:m,d.arg===b)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o=f,a.method="throw",a.arg=d.arg)}}}function S(t,r){var a=r.method,o=t.iterator[a];if(o===e)return r.delegate=null,"throw"===a&&t.iterator.return&&(r.method="return",r.arg=e,S(t,r),"throw"===r.method)||"return"!==a&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+a+"' method")),b;var l=u(o,t.iterator,r.arg);if("throw"===l.type)return r.method="throw",r.arg=l.arg,r.delegate=null,b;var i=l.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function q(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(q,this),this.reset(!0)}function B(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,l=function r(){for(;++o<t.length;)if(a.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return l.next=l}}throw new TypeError(typeof t+" is not iterable")}return w.prototype=y,o(x,"constructor",{value:y,configurable:!0}),o(y,"constructor",{value:w,configurable:!0}),w.displayName=c(y,d,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,d,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},T(L.prototype),c(L.prototype,s,(function(){return this})),t.AsyncIterator=L,t.async=function(e,r,a,o,l){void 0===l&&(l=Promise);var i=new L(h(e,r,a,o),l);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},T(x),c(x,d,"Generator"),c(x,i,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var a in t)r.push(a);return r.reverse(),function e(){for(;r.length;){var a=r.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=B,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(a,o){return n.type="throw",n.arg=t,r.next=a,o&&(r.method="next",r.arg=e),!!o}for(var l=this.tryEntries.length-1;l>=0;--l){var i=this.tryEntries[l],n=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),d=a.call(i,"finallyLoc");if(s&&d){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&a.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var l=o;break}}l&&("break"===e||"continue"===e)&&l.tryLoc<=t&&t<=l.finallyLoc&&(l=null);var i=l?l.completion:{};return i.type=e,i.arg=t,l?(this.method="next",this.next=l.finallyLoc,b):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var o=a.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,a){return this.delegate={iterator:B(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=e),b}},t}function s(e,t,r,a,o,l,i){try{var n=e[l](i),s=n.value}catch(e){return void r(e)}n.done?t(s):Promise.resolve(s).then(a,o)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(a,o){var l=e.apply(t,r);function i(e){s(l,a,o,i,n,"next",e)}function n(e){s(l,a,o,i,n,"throw",e)}i(void 0)}))}}import c from"quill";var h="createTable",u="contain",p="tableWrapper",m="table",v="colgroup",f="col",b="tbody",g="tr",w="td",y="tableCellInner",C="table",I="table",N=()=>Math.random().toString(36).slice(2),x=8e3,T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.child,r=e.target,a=void 0===r?document.body:r,o=e.beforeClose,l=void 0===o?()=>{}:o,i=a,n=document.createElement("div");n.classList.add("dialog"),n.style.zIndex=x;var s=document.createElement("div");if(s.classList.add("dialog_overlay"),n.appendChild(s),t){var d=document.createElement("div");d.classList.add("dialog_content"),d.appendChild(t),s.appendChild(d),d.addEventListener("click",(e=>{e.stopPropagation()}))}var c=getComputedStyle(i).overflow;i.style.overflow="hidden",i.appendChild(n);var h=()=>{l(),n.remove(),i.style.overflow=c};return n.addEventListener("click",h),x+=1,{dialog:n,close:h}},L=(e,t)=>{t.type||(t.type="text"),t.value||(t.value="");var r=document.createElement("div");if(r.classList.add("input_item"),e){var a=document.createElement("span");a.classList.add("input_label"),a.textContent=e,r.appendChild(a)}var o=document.createElement("div");o.classList.add("input_input");var l=document.createElement("input");for(var i in t)l.setAttribute(i,t[i]);(t.max||t.min)&&l.addEventListener("blur",(()=>{t.max&&t.max<=l.value&&(l.value=t.max),t.min&&t.min>=l.value&&(l.value=t.min)})),o.appendChild(l),r.appendChild(o),l.addEventListener("focus",(()=>{o.classList.add("focus")})),l.addEventListener("blur",(()=>{o.classList.remove("focus")}));var n=e=>{if(o.classList.contains("error"))o.querySelector(".error_tip").textContent=e;else{var t=document.createElement("span");t.classList.add("error_tip"),t.textContent=e,o.appendChild(t)}o.classList.add("error");return{removeError:()=>{o.classList.remove("error"),n.remove()}}};return{item:r,input:l,errorTip:n}},E=function(){var e=d(n().mark((function e(){var t,r,a,o,l,i,s,c,h,u,p,m,v,f,b,g=arguments;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=g.length>0&&void 0!==g[0]?g[0]:3,r=g.length>1&&void 0!==g[1]?g[1]:3,(a=document.createElement("div")).classList.add("create_box"),(o=document.createElement("div")).classList.add("create_input_content"),l=L("row",{type:"number",value:t,max:99}),i=l.item,s=l.input,c=l.errorTip,h=L("col",{type:"number",value:r,max:99}),u=h.item,p=h.input,m=h.errorTip,o.appendChild(i),o.appendChild(u),a.appendChild(o),(v=document.createElement("div")).classList.add("create_control"),(f=document.createElement("button")).classList.add("create_control_btn","confirm"),f.textContent="Confirm",(b=document.createElement("button")).classList.add("create_control_btn","cancel"),b.textContent="Cancel",v.appendChild(f),v.appendChild(b),a.appendChild(v),e.abrupt("return",new Promise(((e,t)=>{var r=T({child:a,beforeClose:t}).close;f.addEventListener("click",d(n().mark((function t(){var a,o;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Number(s.value),o=Number(p.value),!(Number.isNaN(a)||a<=0)){t.next=4;break}return t.abrupt("return",c("Invalid number"));case 4:if(!(Number.isNaN(o)||o<=0)){t.next=6;break}return t.abrupt("return",m("Invalid number"));case 6:e({row:a,col:o}),r();case 8:case"end":return t.stop()}}),t)})))),b.addEventListener("click",(()=>{r()}))})));case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function S(e,t){if("object"==typeof t)for(var r in t)e.style[r]=t[r]}function q(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,a=e.x,o=e.y,l=e.x1,i=e.y1,n=t.x,s=t.y,d=t.x1,c=t.y1;return!(l<=n+r||a+r>=d||(i<=s+r||o+r>=c))}function O(e,t){for(var r=e.parent;r&&r.statics.blotName!==t&&r!==e.scroll;)r=r.parent;if(r===e.scroll)throw new Error("".concat(e.statics.blotName," must be a child of ").concat(t));return r}function k(e){return"function"==typeof e}var B={insertColumnLeft:{text:"在左侧插入一列",handler(){var e=this.quill.getModule(C);e.appendCol(),e.hideTableTools()}},insertColumnRight:{text:"在右侧插入一列",handler(){var e=this.quill.getModule(C);e.appendCol(!0),e.hideTableTools()}},insertRowTop:{text:"在上方插入一行",handler(){var e=this.quill.getModule(C);e.appendRow(),e.hideTableTools()}},insertRowBottom:{text:"在下方插入一行",groupEnd:!0,handler(){var e=this.quill.getModule(C);e.appendRow(!0),e.hideTableTools()}},removeCol:{text:"删除所在列",handler(){var e=this.quill.getModule(C);e.removeCol(),e.hideTableTools()}},removeRow:{text:"删除所在行",handler(){var e=this.quill.getModule(C);e.removeRow(),e.hideTableTools()}},removeTable:{text:"删除表格",groupEnd:!0,handler(){var e=this.quill.getModule(C);e.removeTable(),e.hideTableTools()}},mergeCell:{text:"合并单元格",handler(){var e=this.quill.getModule(C);e.mergeCells(),e.hideTableTools()}},splitCell:{text:"拆分单元格",groupEnd:!0,handler(){var e=this.quill.getModule(C);e.splitCell(),e.hideTableTools()}},setBackgroundColor:{text:"设置背景颜色",isColorChoose:!0,handler(e){this.quill.getModule(C).setStyle({backgroundColor:e},this.selectedTds)}},clearBackgroundColor:{text:"清除背景颜色",handler(){this.quill.getModule(C).setStyle({backgroundColor:null},this.selectedTds)}},setBorderColor:{text:"设置边框颜色",isColorChoose:!0,handler(e){this.quill.getModule(C).setStyle({borderColor:e},this.selectedTds)}},clearBorderColor:{text:"清除边框颜色",handler(){this.quill.getModule(C).setStyle({borderColor:null},this.selectedTds)}}};class M{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.table=e.table,this.quill=t,this.options=r;var a=this.quill.getModule(C);this.tableSelection=a.tableSelection,this.menuItems={},this.mergeMenuItems(),this.boundary=this.tableSelection.boundary,this.selectedTds=this.tableSelection.selectedTds,this.destroyHandler=this.destroy.bind(this),this.menuInitial(e),document.addEventListener("click",this.destroyHandler,!1)}mergeMenuItems(){var e,t,r,a;if(null!==(e=this.options)&&void 0!==e&&e.replaceItems)this.menuItems=null!==(r=null===(a=this.options)||void 0===a?void 0:a.items)&&void 0!==r?r:{};else if(null!==(t=this.options)&&void 0!==t&&t.modifyItems){var o,l;this.menuItems=this.modifyMenuItems(null!==(o=null===(l=this.options)||void 0===l?void 0:l.items)&&void 0!==o?o:{})}else this.menuItems=B}modifyMenuItems(){var e;if(null===(e=this.options)||void 0===e||!e.modifyItems)return B;for(var r=l({},B),a=0,o=Object.entries(null===(i=this.options)||void 0===i?void 0:i.items);a<o.length;a++){var i,n=t(o[a],2),s=n[0],d=n[1];r[s]=Object.assign(l({},r[s]),d)}return r}setMenuPosition(e){var t=e.left,r=e.top,a=this.quill.container.getBoundingClientRect(),o=this.domNode.getBoundingClientRect(),l=t-a.left,i=r-a.top;l+o.width>a.width&&(l=a.width-o.width),i+o.height>a.height&&(i=a.height-o.height),Object.assign(this.domNode.style,{left:"".concat(l,"px"),top:"".concat(i,"px")})}menuInitial(e){e._table,e._row,e._cell;var r=e.left,a=e.top;this.domNode=document.createElement("div"),this.domNode.classList.add("ql-table-operation-menu"),S(this.domNode,{position:"absolute","min-height":"".concat(150,"px")});for(var o=0,l=Object.entries(this.menuItems);o<l.length;o++){var i=t(l[o],2),n=i[0],s=i[1];s.subTitle&&this.domNode.appendChild(c(s.subTitle)),this.domNode.appendChild(this.menuItemCreator(Object.assign({},B[n],s))),s.groupEnd&&this.domNode.appendChild(d())}function d(){var e=document.createElement("div");return e.classList.add("ql-table-operation-menu-dividing"),e}function c(e){var t=document.createElement("div");return t.classList.add("ql-table-operation-menu-subtitle"),t.textContent=e,t}this.quill.container.appendChild(this.domNode),this.setMenuPosition({left:r,top:a})}destroy(){return this.domNode.remove(),document.removeEventListener("click",this.destroyHandler,!1),null}menuItemCreator(e){var t=e.text,r=e.iconSrc,a=e.handler,o=e.isColorChoose,l=document.createElement(o?"label":"div");if(l.classList.add("ql-table-operation-menu-item"),r){var i=document.createElement("span");i.classList.add("ql-table-operation-menu-icon"),i.innerHTML=r,l.appendChild(i)}if("string"==typeof t){var n=document.createElement("span");n.classList.add("ql-table-operation-menu-text"),n.textContent=t,l.appendChild(n)}else if(k(t)){var s=t.call(this);(function(e){return Array.isArray(e)})(s)||(s=[s]),s.map((e=>l.appendChild(e)))}if(o){var d=document.createElement("input");d.type="color",Object.assign(d.style,{width:0,height:0,padding:0,border:0}),k(a)&&(l.addEventListener("click",(e=>e.stopPropagation())),d.addEventListener("input",(()=>{a.call(this,d.value)}),!1)),l.appendChild(d)}else k(a)&&l.addEventListener("click",a.bind(this),!1);return l}}var _=c.import("blots/container"),A=c.import("parchment");class j extends _{static create(){return super.create()}insertBefore(e,t){e.statics.blotName===this.statics.blotName?super.insertBefore(e.children.head,t):super.insertBefore(e,t)}format(e,t){this.children.tail.format(e,t)}replace(e){if(e.statics.blotName!==this.statics.blotName){var t=A.create(this.statics.defaultChild);e.moveChildren(t),this.appendChild(t)}null!=e.parent&&super.replace(e)}}j.blotName=u,j.tagName="contain",j.scope=A.Scope.BLOCK_BLOT,j.defaultChild="block";var R=c.import("parchment");class H extends j{static create(e){var t=e.tableId,r=e.rowId,a=e.colId,o=e.rowspan,l=e.colspan,i=e.style,n=super.create();return n.dataset.tableId=t,n.dataset.rowId=r,n.dataset.colId=a,n.dataset.rowspan=o||1,n.dataset.colspan=l||1,n._style=i,n}clearDeltaCache(){this.children.forEach((e=>{e.cache={}}))}get rowId(){return this.domNode.dataset.rowId}set rowId(e){this.parent&&(this.parent.rowId=e),this.domNode.dataset.rowId=e}get colId(){return this.domNode.dataset.colId}set colId(e){this.parent&&(this.parent.colId=e),this.domNode.dataset.colId=e}get rowspan(){return Number(this.domNode.dataset.rowspan)}set rowspan(e){this.parent&&(this.parent.rowspan=e),this.domNode.dataset.rowspan=e,this.clearDeltaCache()}get colspan(){return Number(this.domNode.dataset.colspan)}set colspan(e){this.parent&&(this.parent.colspan=e),this.domNode.dataset.colspan=e,this.clearDeltaCache()}get style(){return this.parent.style}set style(e){this.parent.style=e,this.domNode._style=this.parent.style,this.clearDeltaCache()}getColumnIndex(){return O(this,m).getColIds().indexOf(this.colId)}replace(e){if(e.statics.blotName!==this.statics.blotName){var t=e.clone();e.moveChildren(t),this.appendChild(t),e.parent.insertBefore(this,e.next),e.remove()}else super.replace(e)}format(e,t){super.format(e,t),this.clearDeltaCache()}formats(){var e=this.domNode.dataset,t=e.tableId,r=e.rowId,a=e.colId,o=e.rowspan,l=e.colspan;return{[this.statics.blotName]:{tableId:t,rowId:r,colId:a,rowspan:o,colspan:l,style:this.domNode._style}}}optimize(){super.optimize();var e=this.parent,t=this.domNode.dataset,r=t.tableId,a=t.colId,o=t.rowId,l=t.rowspan,i=t.colspan;if(null!=e&&e.statics.blotName!==w){var n=R.create("block");this.parent.insertBefore(n,this.next);var s=R.create(p,r),d=R.create(m,r),c=R.create(b),h=R.create(g,o),u=R.create(w,{tableId:r,rowId:o,colId:a,rowspan:l,colspan:i,style:this.domNode._style});u.appendChild(this),h.appendChild(u),c.appendChild(h),d.appendChild(c),s.appendChild(d),s.replace(n)}var v=this.next;null!=v&&v.prev===this&&v.statics.blotName===this.statics.blotName&&(v.moveChildren(this),v.remove())}}H.blotName=y,H.tagName="p",H.className="ql-table-cell-inner";var D=c.import("blots/container"),P=c.import("parchment");class F extends D{static create(e){var t=super.create();return t.dataset.rowId=e,t}optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.dataset.rowId===this.domNode.dataset.rowId&&(e.moveChildren(this),e.remove())}get rowId(){return this.domNode.dataset.rowId}insertCell(e,t){for(var r,a=[],o=this.children.iterator(),l=0;(r=o())&&!((l+=r.colspan)>e);)if(1!==r.rowspan)for(var i=0;i<r.rowspan-1;i++)a[i]=(a[i]||0)+r.colspan;if(r&&l-r.colspan<e){r.getCellInner().colspan+=1,1!==r.rowspan&&(a.skipRowNum=r.rowspan-1)}else{var n=P.create(w,t),s=P.create(y,t),d=P.create("block");d.appendChild(P.create("break")),s.appendChild(d),n.appendChild(s),this.insertBefore(n,r)}return a}getCellByColumIndex(e){var t,r=[],a=0;if(e<0)return[t,a,r];for(var o=this.children.iterator();t=o();){if(a+=t.colspan,1!==t.rowspan)for(var l=0;l<t.rowspan-1;l++)r[l]=(r[l]||0)+t.colspan;if(a>e)break}return[t,a,r]}removeCell(e){if(e<0)return[];var r=t(this.getCellByColumIndex(e),3),a=r[0],o=r[1],l=r[2];if(!a)return l;if(o-a.colspan<e||a.colspan>1){var i=t(a.descendants(H),1)[0];if(1!==a.colspan&&e===o-a.colspan){var n=O(this,m).getColIds();i.colId=n[n.indexOf(i.colId)+1]}1!==a.rowspan&&(l.skipRowNum=a.rowspan-1),i.colspan-=1}else a.remove();return l}foreachCellInner(e){for(var r,a=this.children.iterator(),o=0;r=a();){if(e(t(r.descendants(H),1)[0],o++))break}}}F.blotName=g,F.tagName="tr",F.className="ql-table-row",F.scope=P.Scope.BLOCK_BLOT;var z=c.import("blots/container"),W=c.import("parchment");class X extends z{optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&(e.moveChildren(this),e.remove())}deleteAt(e,t){if(0===e&&t===this.length())return this.parent.remove();this.children.forEachAt(e,t,((e,t,r)=>{e.deleteAt(t,r)}))}insertRow(t){var r=O(this,m);if(r){var a,o=r.getColIds(),l=this.descendants(F),i=new Set(o),n=0,s=e(l);try{for(s.s();!(a=s.n()).done;){var d=a.value;if(n===t)break;d.foreachCellInner((e=>{if(n+e.rowspan>t&&(e.rowspan+=1,i.delete(e.colId),1!==e.colspan))for(var r=o.indexOf(e.colId),a=0;a<e.colspan-1;a++)i.delete(o[r+a+1])})),n+=1}}catch(e){s.e(e)}finally{s.f()}var c,h=N(),u=W.create(g,h),p=e(i);try{for(p.s();!(c=p.n()).done;){var v=c.value,f=W.create(w,{rowId:h,colId:v,rowspan:1,colspan:1}),b=W.create(y,{tableId:r.tableId,rowId:h,colId:v,rowspan:1,colspan:1}),C=W.create("block");C.appendChild(W.create("break")),b.appendChild(C),f.appendChild(b),u.appendChild(f)}}catch(e){p.e(e)}finally{p.f()}this.insertBefore(u,l[t]||null)}}}X.blotName=b,X.tagName="tbody",X.scope=W.Scope.BLOCK_BLOT;var G=c.import("parchment"),K=c.import("blots/container");class U extends K{static create(e){var t=e.rowId,r=e.colId,a=e.rowspan,o=e.colspan,l=e.style,i=super.create();return i.dataset.rowId=t,i.dataset.colId=r,i.setAttribute("rowspan",a||1),i.setAttribute("colspan",o||1),i.style.cssText=l,i}get rowId(){return this.domNode.dataset.rowId}set rowId(e){this.domNode.dataset.rowId=e}get colId(){return this.domNode.dataset.colId}set colId(e){this.domNode.dataset.colId=e}get rowspan(){return Number(this.domNode.getAttribute("rowspan"))}set rowspan(e){this.domNode.setAttribute("rowspan",e)}get colspan(){return Number(this.domNode.getAttribute("colspan"))}set colspan(e){this.domNode.setAttribute("colspan",e)}get style(){return this.domNode.style.cssText}set style(e){Object.assign(this.domNode.style,e)}getCellInner(){return this.descendants(H)[0]}optimize(){super.optimize();var e=this.domNode.dataset,t=e.colId,r=e.rowId,a=e.colspan,o=e.rowspan,l=O(this,m);if(!this.getCellInner()){this.children.forEach((e=>{e.remove()}));var i=G.create(y,{tableId:l.tableId,rowId:r,colId:t,colspan:a||1,rowspan:o||1}),n=G.create("block");n.appendChild(G.create("break")),i.appendChild(n),this.appendChild(i)}var s=this.next;null!=s&&s.prev===this&&s.statics.blotName===this.statics.blotName&&s.domNode.dataset.rowId===r&&s.domNode.dataset.colId===t&&(s.moveChildren(this),s.remove())}deleteAt(e,t){if(0===e&&t===this.length()){var r=this.next||this.prev,a=r&&r.getCellInner();return a&&(a.colspan+=this.colspan),this.remove()}this.children.forEachAt(e,t,((e,t,r)=>{e.deleteAt(t,r)}))}}U.blotName=w,U.tagName="td",U.className="ql-table-cell",U.scope=G.Scope.BLOCK_BLOT;var Y=c.import("parchment");class V extends j{static create(e){var t=e.width,r=e.tableId,a=e.colId,o=e.full,l=super.create();return l.setAttribute("width","".concat(Number.parseFloat(t)).concat(o?"%":"px")),o&&(l.dataset.full=o),l.dataset.tableId=r,l.dataset.colId=a,l.setAttribute("contenteditable",!1),l}get width(){var e=this.domNode.getAttribute("width");return Number.parseFloat(e)}set width(e){var t=Number.parseFloat(e);return this.domNode.setAttribute("width","".concat(t).concat(this.full?"%":"px"))}get colId(){return this.domNode.dataset.colId}get full(){return Object.hasOwn(this.domNode.dataset,"full")}formats(){var e=this.domNode.dataset,t=e.tableId,r=e.colId;return{[this.statics.blotName]:{tableId:t,colId:r,width:this.domNode.getAttribute("width"),full:Object.hasOwn(this.domNode.dataset,"full")}}}optimize(){super.optimize();var e=this.parent;if(null!=e&&e.statics.blotName!==v){var t=Y.create("block");this.parent.insertBefore(t,this.next);var r=Y.create(p,this.domNode.dataset.tableId),a=Y.create(m,this.domNode.dataset.tableId);this.full&&(a.full=!0);var o=Y.create(v);o.appendChild(this),a.appendChild(o),r.appendChild(a),r.replace(t)}var l=this.next,i=this.domNode.dataset,n=i.tableId,s=i.colId;null!=l&&l.statics.blotName===this.statics.blotName&&l.domNode.tagName===this.domNode.tagName&&l.domNode.dataset.tableId===n&&l.domNode.dataset.colId===s&&(l.moveChildren(this),l.remove())}}V.blotName=f,V.tagName="col",V.scope=Y.Scope.BLOCK_BLOT;var Z=c.import("blots/container"),$=c.import("parchment");class J extends Z{constructor(e,t){super(e,t),this.formatTableWidth()}static create(e){var t=super.create();return t.dataset.tableId=e,t.classList.add("ql-table"),t.setAttribute("cellpadding",0),t.setAttribute("cellspacing",0),t}colWidthFillTable(){if(!this.full){var e=this.descendants(V);if(e){var t=e.reduce(((e,t)=>t.width+e),0);return 0===t||Number.isNaN(t)||this.full?null:(this.domNode.style.width="".concat(t,"px"),t)}}}formatTableWidth(){setTimeout((()=>{this.colWidthFillTable()}),0)}get tableId(){return this.domNode.dataset.tableId}get full(){return Object.hasOwn(this.domNode.dataset,"full")}set full(e){this.domNode[e?"setAttribute":"removeAttribute"]("data-full","")}getRows(){return this.descendants(F)}getRowIds(){return this.getRows().map((e=>e.rowId))}getCols(){return this.descendants(V)}getColIds(){return this.getCols().map((e=>e.colId))}optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&e.domNode.dataset.tableId===this.domNode.dataset.tableId&&(e.moveChildren(this),e.remove())}}J.blotName=m,J.tagName="table",J.scope=$.Scope.BLOCK_BLOT;var Q=c.import("blots/container"),ee=c.import("parchment");class te extends Q{optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&(e.moveChildren(this),e.remove())}deleteAt(e,t){if(0===e&&t===this.length())return this.parent.remove();this.children.forEachAt(e,t,((e,t,r)=>{e.deleteAt(t,r)}))}findCol(e){for(var t,r=this.children.iterator(),a=0;(t=r())&&a!==e;)a++;return t}insertColByIndex(e,t){var r=this.parent;if(!(r instanceof J))throw new TypeError("TableColgroupFormat should be child of TableFormat");var a=this.findCol(e),o=ee.create(f,t);if(r.full)for(var l,i=this.children.iterator();l=i();)if(l.width-o.width>=3){l.width-=o.width;break}this.insertBefore(o,a)}removeColByIndex(e){if(!(this.parent instanceof J))throw new TypeError("TableColgroupFormat should be child of TableFormat");var t=this.findCol(e);t.next?t.next.width+=t.width:t.prev&&(t.prev.width+=t.width),t.remove()}}te.blotName=v,te.tagName="colgroup",te.scope=ee.Scope.BLOCK_BLOT;var re=c.import("blots/container"),ae=c.import("parchment");class oe extends re{static create(e){var t=super.create();return t.dataset.tableId=e,t.addEventListener("dragstart",(e=>{e.preventDefault(),e.stopPropagation()}),!0),t.addEventListener("drop",(e=>{e.preventDefault()})),t.addEventListener("dragover",(e=>{e.preventDefault(),e.dataTransfer.dropEffect="none"})),t}get tableId(){return this.domNode.dataset.tableId}insertBefore(e,t){e.statics.blotName===this.statics.blotName?super.insertBefore(e.children.head,t):this.statics.allowedChildren.some((t=>t.blotName===e.statics.blotName))?super.insertBefore(e,t):t?this.prev?this.prev.insertBefore(e,null):this.parent.insertBefore(e,this):this.next?this.next.insertBefore(e,t):this.parent.appendChild(e)}optimize(){super.optimize();var e=this.next;null!=e&&e.prev===this&&e.statics.blotName===this.statics.blotName&&e.domNode.tagName===this.domNode.tagName&&e.domNode.dataset.tableId===this.domNode.dataset.tableId&&(e.moveChildren(this),e.remove())}deleteAt(e,t){var r;super.deleteAt(e,t),null===(r=document.querySelector('.ql-table-tooltip[data-table-id="'.concat(this.tableId,'"]')))||void 0===r||null===(r=r.classList)||void 0===r||r.add("ql-hidden")}}oe.blotName=p,oe.tagName="p",oe.className="ql-table-wrapper",oe.scope=ae.Scope.BLOCK_BLOT;var le=c.import("parchment"),ie=c.import("formats/list/item");class ne extends ie{replaceWith(e,t){if(this.parent.isolate(this.offset(this.parent),this.length()),e===this.parent.statics.blotName)return this.parent.replaceWith(e,t),this;if(e===y){var r="string"==typeof e?le.create(e,t):e;return r.replace(this.parent),this.attributes.copy(r),r}return super.replaceWith(e,t)}}var se="#0589f3";class de{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.table=e,this.quill=t,this.options=r,this.optionsMerge(),!e)return null;this.startScrollX=0,this.boundary={},this.selectedTds=[],this.dragging=!1,this.selectingHandler=this.mouseDownHandler.bind(this),this.cellSelect=null,this.scrollHandler=[],this.helpLinesInitial(),new ResizeObserver((()=>{this.hideSelection()})).observe(this.quill.root),this.quill.root.addEventListener("mousedown",this.selectingHandler,!1),this.closeHandler=this.hideSelection.bind(this),this.quill.on(c.events.TEXT_CHANGE,this.closeHandler)}optionsMerge(){var e;(null===(e=this.options)||void 0===e?void 0:e.primaryColor)&&(se=this.options.primaryColor)}addScrollEvent(e,t){e.addEventListener("scroll",t),this.scrollHandler.push([e,t])}clearScrollEvent(){for(var e=0;e<this.scrollHandler.length;e++){var r=t(this.scrollHandler[e],2),a=r[0],o=r[1];a.removeEventListener("scroll",o)}this.scrollHandler=[]}helpLinesInitial(){this.cellSelect=this.quill.addContainer("ql-table-selection_line"),S(this.cellSelect,{"border-color":se})}mouseDownHandler(e){var t=e.button,r=e.target,a=e.clientX,o=e.clientY,l=r.closest(".ql-table");if(0===t&&l){var i=l.dataset.tableId,n={x:a,y:o};this.startScrollX=this.table.parentNode.scrollLeft,this.selectedTds=this.computeSelectedTds(n,n),this.showSelection();var s=e=>{var t=e.button,r=e.target,a=e.clientX,o=e.clientY;this.selectedTds.length>1&&e.preventDefault();var l=r.closest(".ql-table");if(0===t&&l&&l.dataset.tableId===i){this.dragging=!0;var s={x:a,y:o};this.selectedTds=this.computeSelectedTds(n,s),this.selectedTds.length>1&&this.quill.blur(),this.updateSelection()}},d=()=>{document.body.removeEventListener("mousemove",s,!1),document.body.removeEventListener("mouseup",d,!1),this.dragging=!1};document.body.addEventListener("mousemove",s,!1),document.body.addEventListener("mouseup",d,!1)}}computeSelectedTds(t,r){var a=c.find(this.table);if(!a)return[];for(var o,i,n,s=new Set(a.descendants(U)),d={x:Math.min(r.x,t.x),y:Math.min(r.y,t.y),x1:Math.max(r.x,t.x),y1:Math.max(r.y,t.y)},h=new Set,u=!0;u;){u=!1;var p,m=e(s);try{for(m.s();!(p=m.n()).done;){var v=p.value;v.__rect||(v.__rect=v.domNode.getBoundingClientRect());var f=v.__rect,b=f.x,g=f.y,w=f.right,y=f.bottom;if(q(d,{x:b,y:g,x1:w,y1:y},2)){h.add(v),s.delete(v),d={x:Math.min(d.x,b),y:Math.min(d.y,g),x1:Math.max(d.x1,w),y1:Math.max(d.y1,y)},u=!0;break}}}catch(e){m.e(e)}finally{m.f()}}for(var C=0,I=[...h,...s];C<I.length;C++){delete I[C].__rect}return this.boundary=(o=l(l({},d),{},{width:d.x1-d.x,height:d.y1-d.y}),i=this.quill.root.parentNode,n=i.getBoundingClientRect(),{x:o.x-n.x-i.scrollLeft,y:o.y-n.y-i.scrollTop,x1:o.x-n.x-i.scrollLeft+o.width,y1:o.y-n.y-i.scrollTop+o.height,width:o.width,height:o.height}),Array.from(h).map((e=>e.getCellInner()))}updateSelection(){if(0!==this.selectedTds.length){var e=this.table.parentNode.scrollLeft,t=this.quill.root.parentNode.scrollTop;S(this.cellSelect,{left:"".concat(this.boundary.x+(this.startScrollX-e)-1,"px"),top:"".concat(2*t+this.boundary.y,"px"),width:"".concat(this.boundary.width+1,"px"),height:"".concat(this.boundary.height+1,"px")})}}showSelection(){this.clearScrollEvent(),S(this.cellSelect,{display:"block"}),this.updateSelection(),this.addScrollEvent(this.table.parentNode,(()=>{this.updateSelection()}));var e=()=>{this.hideSelection(),this.quill.root.removeEventListener("scroll",e)};this.addScrollEvent(this.quill.root,e)}hideSelection(){this.boundary={},this.selectedTds=[],this.cellSelect&&S(this.cellSelect,{display:"none"}),this.clearScrollEvent()}destroy(){return this.hideSelection(),this.cellSelect.remove(),this.cellSelect=null,this.clearScrollEvent(),this.quill.root.removeEventListener("mousedown",this.selectingHandler,!1),this.quill.off(c.events.TEXT_CHANGE,this.closeHandler),null}}var ce=12;class he{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,"position",(()=>{var e=this.table.domNode.getBoundingClientRect(),t=this.quill.root.getBoundingClientRect();S(this.root,{top:"".concat(e.y-t.y-ce,"px"),left:"".concat(e.x-t.x+this.tableWrapper.domNode.scrollLeft,"px")})})),this.quill=e,this.options=t,this.optionsMerge(),this.tableDisableToolHandlers={},this.tableWrapper=null,this.table=null,this.curTableId="",this.focusTableChange=!1,this.tableCols=[],this.scrollHandler=[],this.root=this.quill.addContainer("ql-table-tooltip"),this.root.style.height="".concat(ce,"px"),new ResizeObserver((e=>{this.hide(),this.focusTableChange=!0,this.curTableId=""})).observe(this.quill.root),this.isMobile="ontouchstart"in window,this.handledEvents=this.isMobile?{down:"touchstart",move:"touchmove",up:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup"},this.hide(),this.listen()}optionsMerge(){var e,t;(null===(e=this.options)||void 0===e?void 0:e.tipHeight)&&(ce=this.options.tipHeight),he.disableToolNames=Array.from(new Set([...he.disableToolNames,...(null===(t=this.options)||void 0===t?void 0:t.disableToolNames)||[]]))}listen(){this.quill.on(c.events.EDITOR_CHANGE,(e=>{if(e===c.events.TEXT_CHANGE)return this.hide();var r=this.quill.getSelection();if(null==r)return this.hide(),void this.enableFromTable();var a=t(this.quill.scroll.descendant(oe,r.index),1)[0];if(null!==a){var o;this.disableFromTable(),this.tableWrapper=a,this.table=a.children.head;for(var l=a.children.tail;l&&l.statics.blotName!==b;){var i;l=null===(i=l.children)||void 0===i?void 0:i.tail}var n=null===(o=a.children.head)||void 0===o||null===(o=o.children)||void 0===o?void 0:o.head;this.tableCols=n.statics.blotName===v&&n.children.length>0?n.children.map((e=>e)):[];var s=a.children.head.tableId;return this.curTableId!==s&&(this.clearScrollEvent(),this.focusTableChange=!0,this.addScrollEvent(this.tableWrapper.domNode,this.scrollSync.bind(this,this.tableWrapper.domNode))),this.curTableId=s,this.show(),void this.position()}this.enableFromTable(),this.hide()}))}disableFromTable(){this.toggleDisableToolbarTools("add");var t=this.quill.getModule("toolbar");if(!t.disableByTable){t.disableByTable=!0;var r,a=e(he.disableToolNames);try{for(a.s();!(r=a.n()).done;){var o=r.value;this.tableDisableToolHandlers[o]=t.handlers[o],t.handlers[o]=()=>{}}}catch(e){a.e(e)}finally{a.f()}}}enableFromTable(){this.toggleDisableToolbarTools("remove");var e=this.quill.getModule("toolbar");for(var t in this.tableDisableToolHandlers)e.handlers[t]=this.tableDisableToolHandlers[t];this.tableDisableToolHandlers={},e.disableByTable=!1}toggleDisableToolbarTools(r){var a,o=this.quill.getModule("toolbar"),l=e(o.controls);try{for(l.s();!(a=l.n()).done;){var i,n=t(a.value,2),s=n[0],d=n[1];if(he.disableToolNames.includes(s))if("select"===d.tagName.toLowerCase())null===(i=o.container.querySelector(".ql-picker.".concat(d.className)))||void 0===i||i.classList[r]("ql-disabled-table");else d.classList[r]("ql-disabled-table")}}catch(e){l.e(e)}finally{l.f()}}scrollSync(e,t){this.root.scrollLeft=e.scrollLeft}addScrollEvent(e,t){e.addEventListener("scroll",t),this.scrollHandler.push([e,t])}clearScrollEvent(){for(var e=0;e<this.scrollHandler.length;e++){var r=t(this.scrollHandler[e],2),a=r[0],o=r[1];a.removeEventListener("scroll",o)}this.scrollHandler=[]}show(){if(0!==this.tableCols.length){if(this.focusTableChange){var e=this.tableWrapper.domNode.getBoundingClientRect();this.root.dataset.tableId=this.tableWrapper.tableId,this.root.innerHTML=[...this.tableCols].map((t=>{var r=t.width+(this.table.full?"%":"px");return t.width||(r="".concat(t.domNode.getBoundingClientRect().width,"px")),'<div class="ql-table-col-header" style="width: '.concat(r,'">\n            <div class="ql-table-col-separator" style="height: ').concat(e.height+ce-3,'px"></div>\n          </div>')})).join(""),this.focusTableChange=!1,Object.assign(this.root.style,{width:"".concat(e.width,"px")}),this.bindDrag()}setTimeout((()=>{this.scrollSync(this.tableWrapper.domNode)}),0),this.root.classList.remove("ql-hidden");var t=()=>{this.hide(),this.quill.root.removeEventListener("scroll",t)};this.quill.root.addEventListener("scroll",t)}}hide(){this.root.classList.add("ql-hidden")}bindDrag(){var r,a=null,o=-1,l=Array.from(this.root.getElementsByClassName("ql-table-col-header")),i=Array.from(this.root.getElementsByClassName("ql-table-col-separator")),n=document.body,s=e=>{var t=l[o].getBoundingClientRect(),r=this.table.domNode.getBoundingClientRect().width,i=this.isMobile?e.changedTouches[0].clientX:e.clientX;if(this.table.full){var n=.03*r,s=i>t.right?l[o+1]?l[o+1].getBoundingClientRect().right-n:t.right-n:1/0,d=t.x+n;i=Math.min(Math.max(i,d),s)}else i-t.x<26&&(i=t.x+26);a.style.left="".concat(i,"px"),a.dataset.w=i-t.x},d=e=>{var t=Number.parseInt(a.dataset.w);if(this.table.full){var r=t/this.table.domNode.getBoundingClientRect().width*100,i=this.tableCols[o].width;if(r<i){var c=i-(r=Math.max(3,r));this.tableCols[o+1]?this.tableCols[o+1].width="".concat(this.tableCols[o+1].width+c,"%"):this.tableCols[o-1]?this.tableCols[o-1].width="".concat(this.tableCols[o-1].width+c,"%"):r=100,this.tableCols[o].width="".concat(r,"%")}else if(this.tableCols[o+1]){var h=i+this.tableCols[o+1].width;r=Math.min(h-3,r),this.tableCols[o].width="".concat(r,"%"),this.tableCols[o+1].width="".concat(h-r,"%")}}else this.table.domNode.style.width="".concat(Number.parseFloat(this.table.domNode.style.width)-Number.parseFloat(l[o].style.width)+t,"px"),l[o].style.width="".concat(t,"px"),this.tableCols[o].width="".concat(t,"px");this.table.formatTableWidth(),n.removeChild(a),a=null,o=-1,document.removeEventListener(this.handledEvents.up,d),document.removeEventListener(this.handledEvents.move,s),this.quill.getModule(I).hideTableTools()},c=(e,t)=>{document.addEventListener(this.handledEvents.up,d),document.addEventListener(this.handledEvents.move,s),o=e;var r=document.createElement("div");r.classList.add("ql-table-drag-line");var i=this.table.domNode.getBoundingClientRect().width,c=Number.parseFloat(l[o].style.width),h=this.table.full?c/100*i:c;r.dataset.w=h;var u=this.tableWrapper.domNode.getBoundingClientRect();S(r,{top:"".concat(u.y-ce,"px"),left:"".concat(this.isMobile?t.changedTouches[0].clientX:t.clientX,"px"),height:"".concat(u.height+ce,"px")}),n.appendChild(r),a&&n.removeChild(a),a=r},h=e(i.entries());try{for(h.s();!(r=h.n()).done;){var u=t(r.value,2),p=u[0],m=u[1];m.addEventListener(this.handledEvents.down,c.bind(this,p)),m.addEventListener("dragstart",(e=>{e.preventDefault()}))}}catch(e){h.e(e)}finally{h.f()}}}he.disableToolNames=[I,"code-block"];var ue='<svg viewBox="0 0 24 24"><path class="ql-stroke" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5zm0 5h18M10 3v18"/></svg>',pe=c.import("parchment"),me=c.import("delta"),ve=c.import("blots/break"),fe=c.import("blots/block/embed"),be=c.import("blots/block"),ge=c.import("blots/container"),we=c.import("ui/icons");j.allowedChildren=[be,fe,ge],oe.allowedChildren=[J],J.allowedChildren=[X,te],J.requiredContainer=oe,X.allowedChildren=[F],X.requiredContainer=J,te.allowedChildren=[V],te.requiredContainer=J,F.allowedChildren=[U],F.requiredContainer=X,U.allowedChildren=[H,ve],U.requiredContainer=F,H.requiredContainer=U,H.defaultChild="block",c.register({["formats/".concat(j.blotName)]:j,["formats/".concat(H.blotName)]:H,["formats/".concat(U.blotName)]:U,["formats/".concat(F.blotName)]:F,["formats/".concat(X.blotName)]:X,["formats/".concat(J.blotName)]:J,["formats/".concat(oe.blotName)]:oe,["formats/".concat(te.blotName)]:te,["formats/".concat(V.blotName)]:V},!0);var ye=[w,"code-block"];function Ce(e){return ye.includes(e.statics.blotName)}function Ie(e){return!(!e||!e.parent)&&(!!Ce(e.parent)||Ie(e.parent))}class Ne{constructor(e,r){this.quill=e,this.options=r,this.controlItem=null,this.tableInsertSelectCloseHandler=null;var a=this.quill.getModule("toolbar");if(a){var o=a.controls.find((e=>t(e,1)[0]===Ne.toolName));if(o){var l;if(this.controlItem=o[1].parentNode.querySelector(".ql-table.ql-picker"),this.controlItem)(null===(l=this.controlItem.getElementsByClassName("ql-picker-label"))||void 0===l?void 0:l[0]).innerHTML=ue;else this.controlItem=o[1];this.buildCustomSelect(this.options.customSelect,o[1].tagName.toLowerCase(),this.options.customButton),a.addHandler(Ne.toolName,this.handleSelectDisplay.bind(this))}}this.pasteTableHandler(),this.quill.root.addEventListener("click",(t=>{var r=t.path||t.composedPath&&t.composedPath();if(r&&!(r.length<=0)){var a=r.find((e=>e.tagName&&"TABLE"===e.tagName.toUpperCase()&&e.classList.contains("ql-table")));if(a){if(this.table===a)return;this.table&&this.hideTableTools(),this.showTableTools(a,e,this.options.selection)}else this.table&&this.hideTableTools()}}),!1),this.quill.root.addEventListener("contextmenu",(t=>{var r;if(!this.table)return!0;t.preventDefault();var a=t.path||t.composedPath&&t.composedPath();if(a&&!(a.length<=0)){var o=a.find((e=>e.tagName&&"TABLE"===e.tagName.toUpperCase()&&e.classList.contains("ql-table")));if(o&&null!==(r=this.tableSelection)&&void 0!==r&&null!==(r=r.selectedTds)&&void 0!==r&&r.length){this.tableOperationMenu&&(this.tableOperationMenu=this.tableOperationMenu.destroy());var l=a.find((e=>e.tagName&&"TR"===e.tagName.toUpperCase()&&e.dataset.rowId)),i=a.find((e=>e.tagName&&"TD"===e.tagName.toUpperCase()&&e.dataset.rowId));this.tableOperationMenu=new M({table:o,row:l,cell:i,left:t.clientX,top:t.clientY},e,this.options.operationMenu)}}})),(void 0===this.options.dragResize||this.options.dragResize)&&(this.quill.theme.TableTooltip=new he(this.quill,this.options.tableToolTip)),this.listenBalanceCells()}showTableTools(e,t,r){e&&(this.table=e,this.tableSelection=new de(e,t,r))}hideTableTools(){this.tableSelection&&this.tableSelection.destroy(),this.tableOperationMenu&&this.tableOperationMenu.destroy(),this.quill.theme.TableTooltip&&(this.quill.theme.TableTooltip.curTableId=null,this.quill.theme.TableTooltip.hide()),this.tableSelection=null,this.tableOperationMenu=null,this.table=null}pasteTableHandler(){var e=N(),t=N(),r=[],a=0;this.quill.clipboard.addMatcher(m,((t,o)=>{var l,i;if(0===o.ops.length)return o;var n,s=!(null===(l=o.ops[0].attributes)||void 0===l||!l.col),d=t.getBoundingClientRect().width,c=this.options.fullWidth;s&&(c=!(null===(i=o.ops[0].insert)||void 0===i||null===(i=i.col)||void 0===i||!i.full));var h=c?"".concat(Math.max(100/r.length,3),"%"):"".concat(Math.max(d/r.length,26),"px");if(s)for(var u=0;u<o.ops.length&&o.ops[u].attributes[f];u++)Object.assign(o.ops[u].attributes[f],{tableId:e,colId:r[u],full:c,width:o.ops[u].attributes[f].width?Number.parseFloat(o.ops[u].attributes[f].width)+(c?"%":"px"):h});else n=r.reduce(((t,r)=>(t.insert("\n",{[f]:{colId:r,tableId:e,width:h,full:c}}),t)),new me);return e=N(),r=[],a=0,n?n.concat(o):o})),this.quill.clipboard.addMatcher(g,((e,r)=>(t=N(),a=0,r))),this.quill.clipboard.addMatcher(w,((o,l)=>{var i,n=o.getAttribute("rowspan")||1,s=o.getAttribute("colspan")||1,d=+a+ +s-1;if(!r[d])for(var c=d;c>=0;c--)r[c]||(r[c]=N());var h=r[d];return a+=1,"\n"!==(null===(i=l.slice(l.length()-1).ops[0])||void 0===i?void 0:i.insert)&&l.insert("\n"),l.compose((new me).retain(l.length(),{[y]:{tableId:e,rowId:t,colId:h,rowspan:n,colspan:s,style:o.getAttribute("style")}}))}))}buildCustomSelect(e,t,r){var a=this;return d(n().mark((function o(){var l,i,s;return n().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if((l=document.createElement("div")).classList.add("ql-custom-select"),!e||!k(e)){o.next=8;break}return o.next=5,e();case 5:o.t0=o.sent,o.next=9;break;case 8:o.t0=a.createSelect(r);case 9:if(i=o.t0,l.appendChild(i),s=a.controlItem,"select"===t&&(s=a.controlItem.querySelector(".ql-picker-options")),s){o.next=15;break}return o.abrupt("return");case 15:i.addEventListener(h,(e=>{var t=e.detail,r=t.row,o=t.col;r&&o&&a.insertTable(r,o)})),s.appendChild(l);case 17:case"end":return o.stop()}}),o)})))()}handleSelectDisplay(){var e=this;return d(n().mark((function t(){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.controlItem.classList.add("ql-expanded"),e.controlItem.dataset.active=!0,window.removeEventListener("click",e.tableInsertSelectCloseHandler),e.tableInsertSelectCloseHandler=t=>{var r=(t.composedPath&&t.composedPath()||t.path).indexOf(e.controlItem);(r>2||-1===r)&&e.closeSelecte()},window.addEventListener("click",e.tableInsertSelectCloseHandler);case 5:case"end":return t.stop()}}),t)})))()}createSelect(e){return(e=>{var t=document.createElement("div");t.classList.add("create_select");var r=document.createElement("div");r.classList.add("create_select_block");for(var a=0;a<8;a++)for(var o=0;o<8;o++){var l=document.createElement("div");l.classList.add("create_select_block_item"),l.dataset.row=a+1,l.dataset.col=o+1,r.appendChild(l)}var i=document.createElement("div");i.classList.add("create_select_custom"),i.textContent=e||"自定义行列数",t.appendChild(r),t.appendChild(i);var n=e=>{var r=e.row,a=e.col;t.dispatchEvent(new CustomEvent(h,{detail:{row:Number(r),col:Number(a)}}))},s=()=>{var e=t.dataset,a=e.row,o=e.col;if(Array.prototype.forEach.call(r.querySelectorAll(".active"),(e=>{e.classList.remove("active")})),a&&o)for(var l=Array.from(r.children),i=0;i<l.length;i++){if(l[i].dataset.row>a&&l[i].dataset.col>o)return;l[i].dataset.row<=a&&l[i].dataset.col<=o?l[i].classList.add("active"):l[i].classList.remove("active")}};return r.addEventListener("mousemove",(e=>{var r=e.target.dataset,a=r.row,o=r.col;a&&o&&(t.dataset.row=a,t.dataset.col=o,s())})),r.addEventListener("mouseleave",(e=>{delete t.dataset.row,delete t.dataset.col,s()})),r.addEventListener("click",(()=>{var e=t.dataset,r=e.row,a=e.col;r&&a&&n({row:r,col:a})})),i.addEventListener("click",(()=>{E().then((e=>{var t=e.row,r=e.col;n({row:t,col:r})}))})),t})(e)}closeSelecte(){this.controlItem&&(this.controlItem.classList.remove("ql-expanded"),this.controlItem.dataset.active=!1),window.removeEventListener("click",this.tableInsertSelectCloseHandler)}insertTable(e,t){if(e>=30||t>=30)throw new Error("Both rows and columns must be less than 30.");this.quill.focus(),this.range=this.quill.getSelection();var r=this.range;if(null!=r){var a=this.quill.getLeaf(r.index)[0];if(Ie(a))throw new Error("Not supported nesting of ".concat(a.type," type object within a table."));var o=(new me).retain(r.index);o.insert("\n");var l=N(),i=new Array(t).fill(0).map((()=>N())),n=getComputedStyle(this.quill.root),s=n.width,d=n.paddingLeft,h=n.paddingRight;s=Number.parseInt(s),d=Number.parseInt(d),h=Number.parseInt(h),s=s-d-h,o=new Array(t).fill("\n").reduce(((e,r,a)=>(e.insert(r,{[f]:{width:this.options.fullWidth?"".concat(1/t*100,"%"):"".concat(Math.floor(s/t),"px"),tableId:l,colId:i[a],full:this.options.fullWidth}}),e)),o),o=new Array(e).fill(0).reduce((e=>{var r=N();return new Array(t).fill("\n").reduce(((e,t,a)=>(e.insert(t,{[y]:{tableId:l,rowId:r,colId:i[a],rowspan:1,colspan:1}}),e)),e)}),o),this.quill.updateContents(o,c.sources.USER),this.quill.setSelection(r.index+t+t*e+1,c.sources.API),this.quill.focus(),this.closeSelecte()}}removeTable(){var e=this.tableSelection.selectedTds;if(0!==e.length){var t=O(e[0],m);t&&t.remove()}}setStyle(e,t){0!==t.length&&t.map((t=>t.style=e))}fixTableByRemove(r){var a,o=r.getRows(),l=r.getCols(),i=l.reduce(((e,t)=>(e[t.colId]=0,e)),{}),n=[...o].reverse(),s=[],d=e(n.entries());try{var c=function(){var e=t(a.value,2),r=e[0],l=e[1],n=o.length-r-1;l.children.length<=0?s.push(n):l.foreachCellInner((e=>{var t=s.reduce(((t,r)=>e.rowspan+n>r?t+1:t),0);e.rowspan-=t,i[e.colId]+=1}))};for(d.s();!(a=d.n()).done;)c()}catch(e){d.e(e)}finally{d.f()}for(var h=0,u=0,p=Object.values(i);u<p.length;u++){if(0===p[u])for(var m=[],v=0,f=0,b=Object.values(o);f<b.length;f++){var g=b[f],w=m.shift()||0,y=[];v>0?(y=g.getCellByColumIndex(h-w)[2],v-=1):(y=g.removeCell(h-w)).skipRowNum&&(v+=y.skipRowNum);var C,I=e(y.entries());try{for(I.s();!(C=I.n()).done;){var N=t(C.value,2),x=N[0],T=N[1];m[x]=(m[x]||0)+T}}catch(e){I.e(e)}finally{I.f()}}else h+=1}var L,E=e(l);try{for(E.s();!(L=E.n()).done;){var S=L.value;0===i[S.colId]&&(S.prev?S.prev.width+=S.width:S.next&&(S.next.width+=S.width),S.remove())}}catch(e){E.e(e)}finally{E.f()}}appendRow(e){var r=this.tableSelection.selectedTds;if(!(r.length<=0)){var a=r[e?r.length-1:0],o=O(a,m),l=t(o.descendants(X),1)[0];if(l){var i=O(a,g),n=o.getRows().indexOf(i)+(e?a.rowspan:0);l.insertRow(n)}}}removeRow(){var r=this.tableSelection.selectedTds;if(!(r.length<=0)){var a,o=O(r[0],m),l=o.getRows(),i=l.length,n=-1,s=e(r);try{for(s.s();!(a=s.n()).done;){var d=a.value,c=O(d,g),h=l.indexOf(c);h<i&&(i=h),h+d.rowspan>n&&(n=h+d.rowspan)}}catch(e){s.e(e)}finally{s.f()}for(var u={},p=function(e){l[e].foreachCellInner((t=>{t.rowspan+e>n&&(u[t.colId]={rowspan:t.rowspan+e-n,colspan:t.colspan,colIndex:t.getColumnIndex()}),t.parent.remove()}))},v=i;v<Math.min(l.length,n);v++)p(v);if(l[n])for(var f=l[n],b=o.tableId,w=0,y=Object.entries(u);w<y.length;w++){var C=t(y[w],2),I=C[0],N=C[1],x=N.colIndex,T=N.colspan,L=N.rowspan;f.insertCell(x,{tableId:b,rowId:f.rowId,colId:I,colspan:T,rowspan:L})}this.fixTableByRemove(o)}}appendCol(r){var a=this.tableSelection.selectedTds;if(!(a.length<=0)){var o=a.reduce(((e,t)=>{var a=t.getColumnIndex();return(!r&&a<=e[1]||r&&a>=e[1])&&(e=[t,a]),e}),[null,r?0:1/0]),l=t(o,1)[0],i=l.getColumnIndex()+(r?l.colspan:0),n=O(l,m),s=n.tableId,d=N(),c=t(n.descendants(te),1)[0];c&&c.insertColByIndex(i,{tableId:s,colId:d,width:n.full?"6%":"160px",full:n.full});for(var h=n.descendants(F),u=[],p=0,v=0,f=Object.values(h);v<f.length;v++){var b=f[v],g=u.shift()||0;if(p>0)p-=1;else{var w=b.insertCell(i-g,{tableId:s,rowId:b.rowId,colId:d,rowspan:1,colspan:1});w.skipRowNum&&(p+=w.skipRowNum);var y,C=e(w.entries());try{for(C.s();!(y=C.n()).done;){var I=t(y.value,2),x=I[0],T=I[1];u[x]=(u[x]||0)+T}}catch(e){C.e(e)}finally{C.f()}}}}}removeCol(){var r=this.tableSelection.selectedTds;if(!(r.length<=0)){var a,o=r[0],l=O(o,m),i={},n=e(r);try{for(n.s();!(a=n.n()).done;){var s=a.value;i[s.rowId]||(i[s.rowId]=0),i[s.rowId]+=s.colspan}}catch(e){n.e(e)}finally{n.f()}for(var d=Math.max(...Object.values(i)),c=o.getColumnIndex(),h=l.descendants(F),u=0;u<d;u++)for(var p=[],v=0,f=0,b=Object.values(h);f<b.length;f++){var g=b[f],w=p.shift()||0;if(v>0)v-=1;else{var y=g.removeCell(c-w);y.skipRowNum&&(v+=y.skipRowNum);var C,I=e(y.entries());try{for(I.s();!(C=I.n()).done;){var N=t(C.value,2),x=N[0],T=N[1];p[x]=(p[x]||0)+T}}catch(e){I.e(e)}finally{I.f()}}}var L=t(l.descendants(te),1)[0];if(L)for(var E=0;E<d;E++)L.removeColByIndex(c);this.fixTableByRemove(l)}}splitCell(){var t=this.tableSelection.selectedTds;if(1===t.length){var r=t[0];if(1!==r.colspan||1!==r.rowspan){var a=O(r,g),o=O(r,m),l=o.tableId,i=r.getColumnIndex(),n=o.getColIds().slice(i,i+r.colspan).reverse(),s=a,d=r.rowspan;for(r.colspan=1,r.rowspan=1;s&&d>0;){var c,h=e(n);try{for(h.s();!(c=h.n()).done;){var u=c.value;s===a&&u===r.colId||s.insertCell(i+(s===a?1:0),{tableId:l,rowId:s.rowId,colId:u,rowspan:1,colspan:1})}}catch(e){h.e(e)}finally{h.f()}d-=1,s=s.next}}}}mergeCells(){var e=this.tableSelection.selectedTds;if(!(e.length<=1)){var t=e.reduce(((e,t,r)=>{var a=t.colId;e[0][a]||(e[0][a]=0),e[0][a]+=t.rowspan;var o=t.rowId;return e[1][o]||(e[1][o]=0),e[1][o]+=t.colspan,0!==r&&(t.moveChildren(e[2]),t.parent.remove()),e}),[{},{},e[0]]),r=Math.max(...Object.values(t[0])),a=Math.max(...Object.values(t[1])),o=t[2];o.colspan=a,o.rowspan=r;var l=O(o,m);this.fixTableByRemove(l)}}fixUnusuaDeletelTable(r){var a=r.getRows(),o=r.getColIds();if(0===a.length||0===o.length)return r.remove();var l,i,n,s,d,c,h=new Array(a.length).fill(0).map((()=>new Array(o.length).fill(!1))),u=r.tableId,p=e(a.entries());try{for(p.s();!(l=p.n()).done;){for(var m=t(l.value,2),v=m[0],f=m[1],b=0,g=0,C=h[v],I=f.descendants(U);g<o.length;)if(C[g])g+=1;else{var N=I[b];if(N&&N.colId===o[g]){v+N.rowspan-1>=a.length&&(N.getCellInner().rowspan=a.length-v);var x=N.colspan,T=N.rowspan;if(x>1)for(var L=1;L<x;L++)C[g+L]=!0;if(T>1)for(var E=v+1;E<v+T;E++)for(var S=0;S<x;S++)h[E][g+S]=!0;b+=1}else f.insertBefore((i={tableId:u,colId:o[g],rowId:f.rowId},n=void 0,s=void 0,d=void 0,c=void 0,n={tableId:i.tableId,rowId:i.rowId,colId:i.colId,colspan:1,rowspan:1},s=pe.create(w,n),d=pe.create(y,n),(c=pe.create("block")).appendChild(pe.create("break")),d.appendChild(c),s.appendChild(d),s),N);g+=1}if(b<I.length)for(var q=b;q<I.length;q++)I[q].remove()}}catch(e){p.e(e)}finally{p.f()}}balanceTables(){var t,r=e(this.quill.scroll.descendants(J));try{for(r.s();!(t=r.n()).done;){var a=t.value;this.fixUnusuaDeletelTable(a)}}catch(e){r.e(e)}finally{r.f()}}listenBalanceCells(){var e,t,r;this.fixTableByLisenter=(e=this.balanceTables,t=100,function(){for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];clearTimeout(r),r=setTimeout((()=>e.apply(this,o)),t)}),this.quill.on(c.events.SCROLL_OPTIMIZE,(e=>{e.some((e=>!!["TD","TR","TBODY","TABLE"].includes(e.target.tagName)&&(this.fixTableByLisenter(),!0)))}))}}Ne.moduleName=C,Ne.toolName=I,Ne.keyboradHandler={"forbid remove table by backspace":{key:"backspace",collapsed:!0,offset:0,handler(e,r){var a=t(this.quill.getLine(e.index),1)[0];if(a.prev instanceof oe)return!1;if(r.format[y]&&0===a.offset(O(a,y)))return!1;return!0}},"forbid remove table by delete":{key:"delete",collapsed:!0,handler(e,r){var a=t(this.quill.getLine(e.index),2),o=a[0],l=a[1];if(o.next instanceof oe&&l===o.length()-1)return!1;if(r.format[y]){var i=O(o,y);if(o.offset(i)+l===i.length()-1)return!1}return!0}}},Ne.createEventName=h,we[Ne.toolName]=ue;var xe=()=>c.register({"formats/list/item":ne},!0);export{ne as ListItemRewrite,M as TableOperationMenu,de as TableSelection,he as TableTooltip,Ne as default,Ie as isForbidInTable,Ce as isForbidInTableBlot,xe as rewirteFormats,ye as tableCantInsert};
//# sourceMappingURL=index.js.map
